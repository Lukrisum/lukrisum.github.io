{"posts":[{"title":"Hello World","text":"","link":"/2022/12/04/hello-world/"},{"title":"Write Me A Koa","text":"å‰ä¸¤å¤©æœ‰ç©ºï¼Œè·Ÿç€Bç«™ä¸Šçš„è§†é¢‘ï¼Œå®ç°äº†ä¸€ä¸ªç®€æ˜“çš„ koa æ¡†æ¶ï¼ˆä¸åŒ…æ‹¬ koa-routerï¼‰ æ‰‹å†™è¿‡ç¨‹ æ‰‹å†™æºç å‰æˆ‘ä»¬çœ‹çœ‹ç”¨åˆ°äº†å“ªäº›APIï¼Œè¿™äº›å°±æ˜¯æˆ‘ä»¬æ‰‹å†™çš„ç›®æ ‡ã€‚ â€”â€”DennisJiang ä¸ºæ–¹ä¾¿äº†è§£ koa çš„ APIï¼Œè¿™æ˜¯ä¸€ä¸ª Hello World çš„ä¾‹å­ï¼Œéšä¾¿è¯·æ±‚ä¸€ä¸ªè·¯å¾„ï¼ˆ3000ç«¯å£ï¼‰éƒ½è¿”å› Hello World ä»¥åŠä¸€ä¸ª logger ï¼Œå°±æ˜¯è®°å½•ä¸‹å¤„ç†å½“å‰è¯·æ±‚èŠ±äº†å¤šé•¿æ—¶é—´ï¼Œå¹¶é™„å¸¦é”™è¯¯å¤„ç†çš„ç”¨ä¾‹ 1234567891011121314151617181920212223242526const Koa = require(&quot;koa&quot;)const app = new Koa()// usage of middlewareapp.use(async (ctx, next) =&gt; { const start = Date.now(); await next(); const ms = Date.now() - start; console.log(`${ctx.method} ${ctx.url} - ${ms}ms`);});app.use(async (ctx, next) =&gt; { // use cases for ctx ctx.body = &quot;Hello World&quot;;});// koa's error handlingapp.on('error',(e)=&gt;{ console.log(e)})// listen on port 3000app.listen(3000, () =&gt; { console.log(`Server is running on http://127.0.0.1:${port}/`);}); å‚è€ƒæºç ï¼Œåˆ†ä¸ºä»¥ä¸‹æ–‡ä»¶ï¼Œåˆ†åˆ«å®ç°ï¼š application.js ï¼šrequire('koa') å¼•å…¥çš„ koa ç±» context.jsï¼šctx å¯¹è±¡ request.jsï¼šctx.request å¯¹è±¡ response.jsï¼šctx.response å¯¹è±¡ package.jsonï¼šé…ç½®å…¥å£æ–‡ä»¶ç­‰ é…ç½®å…¥å£æ–‡ä»¶ä¸º application.jsï¼š1234// package.json{ &quot;main&quot;:&quot;./application.js&quot;} å®ç° app.use()ï¼Œapp.listen()ï¼Œapp.on() ç­‰123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475// application.jsconst http = require('http')const context = require('./context')const request = require('./request')const response = require('./response')const EventEmmiter = require('events')class Application extends EventEmmiter { constructor() { super() this.context = Object.create(context) this.request = Object.create(request) this.response = Object.create(response) this.middlewares = [] } use(middleware) { this.middlewares.push(middleware) } createContext(req, res) { const ctx = Object.create(this.context) const request = Object.create(this.request) const response = Object.create(this.response) ctx.request = request ctx.request.req = ctx.req = req ctx.response = response ctx.response.res = ctx.res = res return ctx } compose(ctx) { let index = -1 const dispatch = (i) =&gt; { if (index &gt;= i) { return Promise.reject('next() called multiple times') } index = i if (this.middlewares.length == i) return Promise.resolve() let middleware = this.middlewares[i] try { return Promise.resolve(middleware(ctx, () =&gt; dispatch(i + 1))) } catch (e) { return Promise.reject(e) } } return dispatch(0) } handleRequest = (req, res) =&gt; { let ctx = this.createContext(req, res) res.statusCode = 404 this.compose(ctx).then(() =&gt; { const body = ctx.body if (body) { res.end(body) } else { res.end('NOT FOUND') } }).catch((e) =&gt; { this.emit('error', e) }) } listen() { let server = http.createServer(this.handleRequest) server.listen(...arguments) }}module.exports = Application ctx.request å¯¹è±¡çš„å°è£…123456789101112131415161718// request.jsconst url = require('url')const request = { get url() { return this.req.url }, get path() { let { pathname } = url.parse(this.req.url) return pathname }, get query() { let { query } = url.parse(this.req.url, true) return query }}module.exports = request ctx.response å¯¹è±¡çš„å°è£…12345678910111213// response.jsconst response = { _body: undefined, get body() { return this._body }, set body(content) { this.res.statusCode = 200 this._body = content }}module.exports = response ctx å¯¹è±¡çš„å°è£…ï¼ˆåŒæ—¶å°† requestï¼Œresponse å¯¹è±¡æŒ‚è½½ä¸Šå»ï¼‰12345678910111213141516171819202122232425// context.jsconst context = {}function defineGetter(target, key) { context.__defineGetter__(key, function () { return this[target][key] })}function defineSetter(target, key) { context.__defineSetter__(key, function (value) { this[target][key] = value })}defineGetter('request', 'path')defineGetter('request', 'url')defineGetter('request', 'query')defineGetter('response', 'body')defineSetter('response', 'body')module.exports = context æ€»ç»“koa çš„æ ¸å¿ƒåŠŸèƒ½ æä¾›äº†åŠŸèƒ½ä¸°å¯Œçš„ ctxï¼ˆå³ koa æ–‡æ¡£è¯´çš„â€œä¸Šä¸‹æ–‡â€ï¼‰ ç‰¹æœ‰çš„ä¸­é—´ä»¶æµç¨‹ï¼ˆæ´‹è‘±æ¨¡å‹ï¼‰ æ›´å¥½çš„é”™è¯¯å¤„ç† ç¬¬ä¸€æ¬¡å°è¯•å®ç°ä¸€ä¸ªåº“/æ¡†æ¶ï¼Œè™½ç„¶å€ŸåŠ©äº†è§†é¢‘ï¼Œè¿‡ç¨‹ä¹Ÿæ¯”è¾ƒç£•ç£•ç»Šç»Šï¼Œä½†æ˜¯ç°åœ¨å†å»çœ‹ koa å®˜æ–¹æ–‡æ¡£ä¸­çš„ä»‹ç»ï¼Œå°±ä¼šæœ‰ä¸€ç§æç„¶å¤§æ‚Ÿçš„æ„Ÿè§‰ï¼Œè¿™ä¹Ÿè®¸å°±æ˜¯æ‰€è°“â€œé˜…è¯»æºç â€çš„å¥½å¤„ ç›¸å…³é“¾æ¥ æ‰‹å†™ Koa æºç ï¼šhttp://dennisgo.cn/Articles/Node/Koa.htmlB ç«™è§†é¢‘ï¼šhttps://www.bilibili.com/video/BV19M4y1G71B/?spm_id_from=333.337.search-card.all.click&amp;vd_source=8583748192f1bc61f6d8bf9d41576b98","link":"/2022/12/05/write-me-a-koa/"}],"tags":[{"name":"source code","slug":"source-code","link":"/tags/source-code/"}],"categories":[{"name":"Tech","slug":"Tech","link":"/categories/Tech/"},{"name":"FrontEnd","slug":"Tech/FrontEnd","link":"/categories/Tech/FrontEnd/"},{"name":"Node.js","slug":"Tech/FrontEnd/Node-js","link":"/categories/Tech/FrontEnd/Node-js/"}],"pages":[{"title":"about","text":"Hi there ğŸ‘‹ I am Lukrisum.","link":"/about/index.html"}]}